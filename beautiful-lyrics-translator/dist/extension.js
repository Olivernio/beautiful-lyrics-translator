!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.BeautifulLyricsTranslator=e():t.BeautifulLyricsTranslator=e()}(this,()=>(()=>{"use strict";var t={56:(t,e,r)=>{t.exports=function(t){var e=r.nc;e&&t.setAttribute("nonce",e)}},72:t=>{var e=[];function r(t){for(var r=-1,i=0;i<e.length;i++)if(e[i].identifier===t){r=i;break}return r}function i(t,i){for(var n={},o=[],s=0;s<t.length;s++){var l=t[s],c=i.base?l[0]+i.base:l[0],u=n[c]||0,d="".concat(c," ").concat(u);n[c]=u+1;var f=r(d),y={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==f)e[f].references++,e[f].updater(y);else{var p=a(y,i);i.byIndex=s,e.splice(s,0,{identifier:d,updater:p,references:1})}o.push(d)}return o}function a(t,e){var r=e.domAPI(e);return r.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;r.update(t=e)}else r.remove()}}t.exports=function(t,a){var n=i(t=t||[],a=a||{});return function(t){t=t||[];for(var o=0;o<n.length;o++){var s=r(n[o]);e[s].references--}for(var l=i(t,a),c=0;c<n.length;c++){var u=r(n[c]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}n=l}}},113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var r="",i=void 0!==e[5];return e[4]&&(r+="@supports (".concat(e[4],") {")),e[2]&&(r+="@media ".concat(e[2]," {")),i&&(r+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),r+=t(e),i&&(r+="}"),e[2]&&(r+="}"),e[4]&&(r+="}"),r}).join("")},e.i=function(t,r,i,a,n){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(i)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(o[l]=!0)}for(var c=0;c<t.length;c++){var u=[].concat(t[c]);i&&o[u[0]]||(void 0!==n&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=n),r&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=r):u[2]=r),a&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=a):u[4]="".concat(a)),e.push(u))}},e}},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},601:t=>{t.exports=function(t){return t[1]}},659:t=>{var e={};t.exports=function(t,r){var i=function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}e[t]=r}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(r)}},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(r){!function(t,e,r){var i="";r.supports&&(i+="@supports (".concat(r.supports,") {")),r.media&&(i+="@media ".concat(r.media," {"));var a=void 0!==r.layer;a&&(i+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),i+=r.css,a&&(i+="}"),r.media&&(i+="}"),r.supports&&(i+="}");var n=r.sourceMap;n&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,r)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},985:(t,e,r)=>{r.d(e,{A:()=>s});var i=r(601),a=r.n(i),n=r(314),o=r.n(n)()(a());o.push([t.id,".lyric-original{font-size:2rem;font-weight:600;color:var(--color-text);line-height:1.3;margin-bottom:var(--space-8);opacity:.4;transition:opacity var(--duration-normal) var(--ease-standard)}.lyric-original.active{opacity:1}.lyric-original .background-vocals{font-size:.85em;color:var(--blt-background-color);font-style:italic;margin-left:var(--space-8)}.lyric-original .side-vocals{font-size:.8em;color:var(--blt-side-vocal-color);font-weight:500;margin-left:var(--space-8)}.blt-translation{display:block !important;font-size:1.2rem !important;font-weight:500 !important;color:lime !important;background:rgba(255,0,0,.3) !important;font-style:italic;line-height:1.5;margin-top:12px !important;padding:8px !important;opacity:1 !important;visibility:visible !important;text-align:center;border:2px solid #ff0 !important}.blt-translation.blt-active{color:#ff0 !important;font-weight:700 !important}@media(prefers-color-scheme: dark){.blt-translation{color:hsla(0,0%,100%,.6)}.blt-translation.blt-active{color:hsla(0,0%,100%,.9)}}.lyric-original[data-effect=karaoke] .word{display:inline-block;position:relative;color:var(--color-text-secondary);transition:color var(--duration-fast) var(--ease-standard);margin-right:var(--space-4)}.lyric-original[data-effect=karaoke] .word.sung{color:var(--color-primary);transform:scale(1.05);text-shadow:0 0 20px rgba(var(--color-teal-500-rgb), 0.4)}.lyric-original[data-effect=line].active{color:var(--color-primary);text-shadow:0 0 20px rgba(var(--color-teal-500-rgb), 0.3);transform:scale(1.02);transition:all var(--duration-normal) var(--ease-standard)}.lyric-container{margin-bottom:var(--space-32);position:relative}:root{--blt-translation-opacity: 0.85;--blt-translation-delay: 0ms;--blt-background-color: rgba(var(--color-teal-500-rgb), 0.1);--blt-side-vocal-color: rgba(var(--color-warning-rgb), 0.7)}.beautiful-lyrics-translator{position:relative;width:100%}.beautiful-lyrics-translator__container{display:flex;flex-direction:column;gap:var(--space-32);padding:var(--space-16)}",""]);const s=o}},e={};function r(i){var a=e[i];if(void 0!==a)return a.exports;var n=e[i]={id:i,exports:{}};return t[i](n,n.exports,r),n.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.nc=void 0;const i="[BeautifulLyrics Translator]",a=(t,...e)=>{console.log(`${i} â„¹ï¸`,t,...e)},n=(t,...e)=>{console.log(`${i} âœ…`,t,...e)},o=(t,...e)=>{console.warn(`${i} âš ï¸`,t,...e)},s=(t,...e)=>{console.error(`${i} âŒ`,t,...e)};class l{constructor(t){this.config=t}async translateLyrics(t){a(`Translating to ${this.config.targetLanguage}...`);const e=[];for(const r of t)try{const t=await this.translate(r.words,this.config.targetLanguage);e.push({original:{main:r.words,background:r.background,sideVocal:r.sideVocal,syllables:r.syllables},translation:{full:t},timing:{startTimeMs:r.startTimeMs,endTimeMs:r.endTimeMs},effectType:this.detectEffectType(r)})}catch(t){s("Error translating line:",t),e.push({original:{main:r.words,background:r.background,sideVocal:r.sideVocal,syllables:r.syllables},translation:{full:r.words},timing:{startTimeMs:r.startTimeMs,endTimeMs:r.endTimeMs},effectType:this.detectEffectType(r)})}return n(`Translated ${e.length} lines`),e}async translate(t,e){if(!t||""===t.trim())return"";try{const r=`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${e}&dt=t&q=${encodeURIComponent(t)}`,i=await fetch(r);if(!i.ok)throw new Error(`Translation API error: ${i.status}`);const a=await i.json();return a&&a[0]&&a[0][0]&&a[0][0][0]?a[0][0][0]:t}catch(e){return s("Error translating text:",e),t}}detectEffectType(t){return t.syllables&&t.syllables.length>0?"karaoke":"line"}updateConfig(t){this.config={...this.config,...t},a("Translation config updated",t)}}const c={targetLanguage:"es",autoDetectLanguage:!0,translateBackgroundVocals:!1,translateSideVocals:!1,showOriginalBackground:!0,preTranslateAll:!1,cacheEnabled:!0,apiUrl:"https://libretranslate.com"},u='.Root__lyrics-cinema [class*="LineClamp"]';class d{constructor(){this.observer=null,this.isBeautifulLyricsActive=!1}delay(t){return new Promise(e=>setTimeout(e,t))}async detectBeautifulLyrics(){await this.delay(500);const t=document.querySelectorAll(u);return!!(t&&t.length>0)&&(n(`Found ${t.length} lyric elements!`),!0)}observeLyricsContainer(t){const e=document.body;this.observer=new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.length>0&&e.addedNodes.forEach(e=>{e instanceof Element&&e.classList.contains("VocalsGroup")&&(a("ğŸ”„ Beautiful Lyrics container changed, re-rendering..."),t(e))})})}),this.observer.observe(e,{childList:!0,subtree:!0}),a("ğŸ” Observing Beautiful Lyrics container for changes")}getLyricsLines(){const t=document.querySelectorAll(u);return t.length>0?(t.length,t):null}disconnect(){this.observer&&(this.observer.disconnect(),this.observer=null,a("Disconnected Beautiful Lyrics observer"))}isActive(){return this.isBeautifulLyricsActive}}class f{async getLyrics(t){try{const e=document.querySelector(".Root__lyrics-cinema");if(!e)return o("Beautiful Lyrics container not found"),null;const r=e.querySelectorAll(".VocalsGroup");if(!r||0===r.length)return o("No VocalsGroup elements found"),null;n(`Found ${r.length} vocal groups in Beautiful Lyrics`);const i=[];return r.forEach(t=>{const e=t.querySelector(".Vocals.Lead");if(!e)return;const r=e.textContent?.trim()||"";r&&i.push({startTimeMs:"0",words:r,syllables:[],endTimeMs:"0"})}),n(`Extracted ${i.length} lines from Beautiful Lyrics`),{syncType:"LINE_SYNCED",lines:i,provider:"beautiful-lyrics",providerLyricsId:t,providerDisplayName:"Beautiful Lyrics",syncLyricsUri:"",isDenseTypeface:!1,alternatives:[],language:"unknown",isRtlLanguage:!1,fullscreenAction:"FULLSCREEN_LYRICS"}}catch(t){return s("Error getting lyrics from Beautiful Lyrics:",t),null}}getLyricsFromBeautifulLyricsDOM(){try{const t=document.querySelectorAll(u);if(!t||0===t.length)return null;t.length;const e=[];return t.forEach((t,r)=>{const i=t.textContent?.trim()||"";i&&i.length>0&&e.push({startTimeMs:(3e3*r).toString(),words:i,syllables:[],endTimeMs:(3e3*(r+1)).toString()})}),0===e.length?null:{syncType:"LINE_SYNCED",lines:e,provider:"BeautifulLyrics",providerLyricsId:"",providerDisplayName:"Beautiful Lyrics",syncLyricsUri:"",isDenseTypeface:!1,alternatives:[],language:"auto",isRtlLanguage:!1,fullscreenAction:"FULLSCREEN_LYRICS"}}catch(t){return s("Error reading from DOM:",t),null}}}class y{renderTranslations(t){const e=document.querySelectorAll(u);if(0===e.length)return void o("No lyric lines found in Beautiful Lyrics container");a(`Found ${e.length} lyric elements, have ${t.length} translations`);let r=0;e.forEach((e,i)=>{if(i>=t.length)return;const a=t[i];let n=e.nextElementSibling;n&&n.classList.contains("blt-translation")&&n.remove();const o=document.createElement("div");o.className="blt-translation",o.textContent=a.translation.full,e.parentElement&&(e.parentElement.insertBefore(o,e.nextSibling),r++)}),n(`Rendered ${r} translations`)}clearTranslations(){document.querySelectorAll(".blt-translation").forEach(t=>t.remove()),a("Cleared all translations")}updateActiveLine(t){document.querySelectorAll(".blt-translation").forEach((e,r)=>{r===t?e.classList.add("blt-active"):e.classList.remove("blt-active")})}}var p=r(72),h=r.n(p),g=r(825),m=r.n(g),v=r(659),b=r.n(v),L=r(56),T=r.n(L),S=r(540),w=r.n(S),k=r(113),x=r.n(k),E=r(985),P={};P.styleTagTransform=x(),P.setAttributes=T(),P.insert=b().bind(null,"head"),P.domAPI=m(),P.insertStyleElement=w(),h()(E.A,P),E.A&&E.A.locals&&E.A.locals;class C{constructor(){this.currentTrackUri=null,this.isInitialized=!1,this.retryCount=0,this.maxRetries=3,this.translationService=new l(c),this.beautifulLyricsHook=new d,this.spotifyLyricsAPI=new f,this.lyricsRenderer=new y,a("Beautiful Lyrics Translator initialized")}async init(){if(!this.isInitialized)try{await this.waitForSpicetify(),this.setupTrackChangeListener(),a("Waiting 3s before first processing..."),await this.delay(3e3),await this.processCurrentTrack(),this.isInitialized=!0,n("Extension fully initialized")}catch(t){s("Failed to initialize extension:",t)}}async waitForSpicetify(){return new Promise(t=>{const e=()=>{"undefined"!=typeof Spicetify&&Spicetify?.Player?(a("Spicetify API ready"),t()):setTimeout(e,100)};e()})}setupTrackChangeListener(){Spicetify.Player.addEventListener("songchange",()=>{a("ğŸµ Song changed detected!"),this.retryCount=0,setTimeout(()=>this.processCurrentTrack(),2e3)}),a("Track change listener registered")}getTrackUriMultipleMethods(){try{if(Spicetify?.Player?.data?.item?.uri)return a("Got URI from Player.data.item"),Spicetify.Player.data.item.uri}catch(t){}try{if(Spicetify?.Player?.data?.track?.uri)return a("Got URI from Player.data.track"),Spicetify.Player.data.track.uri}catch(t){}try{if(Spicetify?.Player?.data?.uri)return a("Got URI from Player.data"),Spicetify.Player.data.uri}catch(t){}try{if(Spicetify?.Platform?.PlayerAPI?._state?.item?.uri)return a("Got URI from Platform API"),Spicetify.Platform.PlayerAPI._state.item.uri}catch(t){}try{if(Spicetify?.Queue?.track?.uri)return a("Got URI from Queue"),Spicetify.Queue.track.uri}catch(t){}try{if(Spicetify?.Player?.getState){const t=Spicetify.Player.getState();if(t?.item?.uri)return a("Got URI from Player state"),t.item.uri}}catch(t){}return null}async processCurrentTrack(){try{a("--- START PROCESSING TRACK ---"),await this.delay(500);const t=this.getTrackUriMultipleMethods();if(!t)return s("âŒ Could not get track URI after trying all methods"),a("Spicetify object:",Spicetify),a("Player object:",Spicetify?.Player),void a("Player.data:",Spicetify?.Player?.data);if(t===this.currentTrackUri)return;this.currentTrackUri=t;const e=t.split(":").pop()||"";if(a(`âœ… Processing track ID: ${e}`),a(`ğŸ“€ Full URI: ${t}`),this.lyricsRenderer.clearTranslations(),a("ğŸ” Looking for Beautiful Lyrics..."),!await this.detectBeautifulLyricsWithRetry())return void o("âš ï¸ Beautiful Lyrics not active");a("ğŸ“¥ Fetching lyrics from Spotify API...");const r=await this.spotifyLyricsAPI.getLyrics(t);if(!r||!r.lines||0===r.lines.length)return void o("âŒ No lyrics available for this track");n(`âœ… Found ${r.lines.length} lyric lines!`),a(`ğŸŒ Translating to ${c.targetLanguage}...`);const i=await this.translationService.translateLyrics(r.lines);n(`âœ… Translated ${i.length} lines`),await this.delay(1e3),a("ğŸ¨ Rendering translations..."),this.lyricsRenderer.renderTranslations(i),n("ğŸ‰ âœ¨ Translation complete and rendered!"),a("--- END PROCESSING TRACK ---")}catch(t){s("ğŸ’¥ Error processing track:",t)}}async detectBeautifulLyricsWithRetry(){for(;this.retryCount<this.maxRetries;){if(a(`Attempt ${this.retryCount+1}/${this.maxRetries}...`),await this.beautifulLyricsHook.detectBeautifulLyrics())return n("âœ… Beautiful Lyrics found!"),!0;this.retryCount++,this.retryCount<this.maxRetries&&(o("Retry in 1s..."),await this.delay(1e3))}return!1}delay(t){return new Promise(e=>setTimeout(e,t))}}return(async()=>{a("ğŸš€ Starting Beautiful Lyrics Translator...");const t=new C;await t.init()})(),{}})());